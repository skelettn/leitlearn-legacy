/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";const e=()=>{const e=$(".subsidebar-btn"),s=($(".subsidebar"),$(".sidebar"),$(".open-sidebar")),o=$(".dashboard-sidebar");e.on("click",(function(){t($(this))})),a(s,o),n()},t=e=>{const t=e.data("subsidebar"),a=$("#"+t),n=$(".sidebar");$subsidebars.removeClass("show"),e.hasClass("return-btn")?(e.removeClass("return-btn"),a.removeClass("show"),n.removeClass("subsi-active")):(e.addClass("return-btn"),a.addClass("show"),n.addClass("subsi-active"))},a=(e,t)=>{e.length&&t.length&&e.on("click",(function(){s(t)}))},n=()=>{let e=$(".leitlearn_dashboard_sidebar_open_user_detail_open"),t=$(".leitlearn_dashboard_sidebar_open_user_detail_displayed");e.on("click",(function(){t.toggleClass("show")}))},s=e=>{e.hasClass("hidden")?(e.css("marginLeft","0"),e.removeClass("hidden")):(e.css("marginLeft","-100%"),e.addClass("hidden"))},o=async(e,t,a=null)=>{try{let n;n=""!==$.trim(a)?`${e}${t}/${a}`:`${e}${t}`;const s=await fetch(n);return await s.json()}catch(e){throw console.error("Erreur lors de l'appel à l'API",e),e}},i=()=>{const e=$("body");e.on("click",".modal-btn",(function(){const e=$(this).data("modal"),t=$("#"+e);$(".modal").removeClass("show"),t.addClass("show")})),e.on("click",".modal-close",(function(){const e=$(".modal-close").index(this);$(".modal").eq(e).removeClass("show")})),e.on("click",(function(e){$(".modal").each((function(){$(e.target).is($(this))&&$(this).removeClass("show")}))}))},l=()=>{$("body").on("click",".packet-item",(async function(){const e=$(this).data("paquet-id");try{const t=await o("/api/market/get/",e);r(t),$("#detail-modal").addClass("show")}catch(e){console.error("Une erreur est survenue lors de la gestion du modal :",e)}}))},r=e=>{let t=$("#modal-title"),a=$("#modal-detail-description"),n=$("#modal-detail-packet-id"),s=$("#modal-detail-keys").empty(),o=$("#modal-detail-flashcards").empty(),i=$("#modal-detail-selected-packet").empty(),l=$("#modal-detail-creator");if(t.text(e.name),a.text(e.description),n.val(e.id),e.keywords&&e.keywords.length>0){let t=$.map(e.keywords,(function(e,t){return $("<strong>").addClass("key").attr("id","modal-key"+(t+1)).text(e.word)}));s.append(t)}if(e.flashcards&&e.flashcards.length>0){let t=$.map(e.flashcards,(function(e,t){return $("<div>").addClass("flashcard").append($("<div>").addClass("question").html(e.question),$("<div>").addClass("answer").append($("<div>").addClass("content show").html(e.answer)),$("<div>").addClass("import-actions").append($("<div>").addClass("action").append($("<input>").attr({type:"checkbox",name:"flashcards[]",value:e.id,id:"flashcards"+(t+1)}))))}));o.append(t)}let r=e.user_packets;if(r&&r.length>0){let e=$.map(r,(function(e){return $("<option>").attr("value",e.id).text(e.name)}));i.append(e)}let c=e.creator;l.find("strong").text(c.username),l.find("img").attr("src","/img/user_profile_pic/"+c.profile_picture)},c=()=>{$(".flashcard-item").click((async function(){const e=$(this).data("flashcard-id");try{const t=await o("/api/flashcard/get/",e);console.log(t),$("#modify-flashcard").addClass("show"),d(t)}catch(e){console.error("Une erreur est survenue lors de la gestion du modal :",e)}}))},d=e=>{let t=document.getElementById("editor-modify-flashcard-front"),a=document.getElementById("editor-modify-flashcard-back"),n=t.getElementsByClassName("ql-editor")[0],s=a.getElementsByClassName("ql-editor")[0],o=document.querySelector('input[name="flashcard_id"]');n.innerHTML=e.question,s.innerHTML=e.answer,o.value=e.id};function u(e,t,a,n,s,o){let i,l,r,c,d=[["image","video","bold","italic","underline","strike",{list:"bullet"},{list:"ordered"},{"align-left":"Align Left"},{"align-center":"Align Center"},{"align-right":"Align Right"}]];function u(e){let t=e.querySelectorAll("svg");const a={"list: bullet":"format_list_bulleted","list: ordered":"format_list_numbered",image:"add_photo_alternate","":"volume_up",video:"video_library",bold:"format_bold",italic:"format_italic",underline:"format_underlined",strike:"strikethrough_s"};t.forEach((e=>{const t=document.createElement("span");t.classList.add("material-symbols-rounded");const n=e.parentNode.getAttribute("aria-label");t.innerText=a[n]||n,e.parentNode.replaceChild(t,e)}));let n=e.querySelector(".ql-custom-audio"),s=e.querySelector(".ql-align-center"),o=e.querySelector(".ql-align-left"),i=e.querySelector(".ql-align-right");function l(e,t){if(e){let a=document.createElement("span");a.classList.add("material-symbols-rounded"),a.innerText=t,e.appendChild(a)}}l(n,"volume_up"),l(s,"format_align_center"),l(o,"format_align_left"),l(i,"format_align_right")}function m(e,t){function a(){const a=e.root.innerHTML;document.getElementById(t).value=a}e.on("text-change",(function(e,t,n){a()})),a()}function f(e,t){e.querySelector(".ql-align-center").addEventListener("click",(function(){t.format("align","center")})),e.querySelector(".ql-align-right").addEventListener("click",(function(){t.format("align","right")})),e.querySelector(".ql-align-left").addEventListener("click",(function(){t.format("align",!1),t.format("align","left")}))}document.querySelector(e)&&document.querySelector(t)&&(r=new Quill(e,{modules:{toolbar:d},theme:"snow"}),c=new Quill(t,{modules:{toolbar:d},theme:"snow"}),i=document.querySelector(a+" .ql-toolbar"),l=document.querySelector(n+" .ql-toolbar")),i&&l&&(function(e,t){e&&t?(u(e),u(t)):console.log("Au moins une des barres d'outils n'a pas été trouvée.")}(i,l),function(){let e=document.querySelector(a+" .ql-video"),t=document.querySelector(a+" .ql-strike"),s=document.querySelector(n+" .ql-video"),o=document.querySelector(n+" .ql-strike"),i=document.createElement("div");i.classList.add("tools-separator"),e&&t&&(e.parentNode.insertBefore(i.cloneNode(!0),e.nextSibling),t.parentNode.insertBefore(i.cloneNode(!0),t.nextSibling)),s&&o&&(s.parentNode.insertBefore(i.cloneNode(!0),s.nextSibling),o.parentNode.insertBefore(i.cloneNode(!0),o.nextSibling))}(),m(r,s),m(c,o),f(i,r),f(l,c))}const m=()=>{$(".flipped-card").on("click",(function(){g(this)}))},f=()=>{let e=0;const t=$(".game .card"),a=$("#progressBar");$(".change-card").on("click",(function(){const n=parseInt($(this).data("change-card")),s=e+n;s>=0&&s<t.length&&(h(t,e,a,n),e=s)}))},p=()=>{$(".show-btn").on("click",(function(){$(this).closest(".flashcard").find(".content").toggleClass("show")}))},h=(e,t,a,n)=>{$(e[t]).removeClass("active flipped"),t=(t+n+e.length)%e.length,$(e[t]).addClass("active"),e.each((function(e,a){e!==t&&$(a).removeClass("active")}));const s=t/(e.length-1)*100;a.val(s)},g=e=>{$(e).toggleClass("flipped")},v=()=>{$("#market_search").on("input",(async function(){let e=$(this).val();if(""!==$.trim(e)){let t;try{t=await o("/api/explore/get/",e),function(e){let t=$(".search-results");if(t.empty(),0!==e.length)$.each(e,(function(e,a){let n=$('<div class="result packet-item modal-btn" data-modal="detail-modal" data-paquet-id="'+a.id+'">'+a.name+"</div>");t.append(n)}));else{let e=$("<span></span>").text("Aucun résultat trouvé");t.append(e)}}(t)}catch(e){console.error("Une erreur est survenue lors de la récupération des paquets :",e)}}}))};let y=document.body.dataset.csrfToken;const w=async()=>{$("#leitlearn_ai_submit").on("click",(async function(){if($("#leitlearn_ai_input").val().length>0){$(this).hide(),k();let e=await b();C(),_(e),x()}}))};async function b(){let e=$("#leitlearn_ai_input").val();return await o("/api/ai/request/",e)}async function k(){for(let e=1;e<=5;e++){const e=q("ai-skeleton","ai-skeleton");$(".ai-flashcards").append(e),setTimeout((function(){e.addClass("show")}),150)}const e=L();$("#ai-results").append(e)}const C=()=>{$(".ai-flashcard").each((function(){const e=$(this);e.removeClass("show"),setTimeout((function(){e.remove()}),100)})),$(".loading").remove()},_=e=>{$.each(e,(function(e,t){let a=q("question","content show",t.Question,t.Answer);$(".ai-flashcards").append(a),setTimeout((function(){a.addClass("show")}),150)}))},q=(e,t,a="",n="")=>{const s=$("<div>").addClass("flashcard ai-flashcard"),o=$("<div>").addClass(e).text(a);s.append(o);const i=$("<div>").addClass("answer "+t).text(n);return s.append(i),s},L=()=>{const e=document.createElement("div");return e.classList.add("loading","show"),e.innerHTML='<?xml version="1.0" encoding="utf-8"?><svg fill="#FFFFFF" width="25px" height="25px" viewBox="0 0 512 512" id="icons" xmlns="http://www.w3.org/2000/svg"><path d="M208,512a24.84,24.84,0,0,1-23.34-16l-39.84-103.6a16.06,16.06,0,0,0-9.19-9.19L32,343.34a25,25,0,0,1,0-46.68l103.6-39.84a16.06,16.06,0,0,0,9.19-9.19L184.66,144a25,25,0,0,1,46.68,0l39.84,103.6a16.06,16.06,0,0,0,9.19,9.19l103,39.63A25.49,25.49,0,0,1,400,320.52a24.82,24.82,0,0,1-16,22.82l-103.6,39.84a16.06,16.06,0,0,0-9.19,9.19L231.34,496A24.84,24.84,0,0,1,208,512Zm66.85-254.84h0Z"/><path d="M88,176a14.67,14.67,0,0,1-13.69-9.4L57.45,122.76a7.28,7.28,0,0,0-4.21-4.21L9.4,101.69a14.67,14.67,0,0,1,0-27.38L53.24,57.45a7.31,7.31,0,0,0,4.21-4.21L74.16,9.79A15,15,0,0,1,86.23.11,14.67,14.67,0,0,1,101.69,9.4l16.86,43.84a7.31,7.31,0,0,0,4.21,4.21L166.6,74.31a14.67,14.67,0,0,1,0,27.38l-43.84,16.86a7.28,7.28,0,0,0-4.21,4.21L101.69,166.6A14.67,14.67,0,0,1,88,176Z"/><path d="M400,256a16,16,0,0,1-14.93-10.26l-22.84-59.37a8,8,0,0,0-4.6-4.6l-59.37-22.84a16,16,0,0,1,0-29.86l59.37-22.84a8,8,0,0,0,4.6-4.6L384.9,42.68a16.45,16.45,0,0,1,13.17-10.57,16,16,0,0,1,16.86,10.15l22.84,59.37a8,8,0,0,0,4.6,4.6l59.37,22.84a16,16,0,0,1,0,29.86l-59.37,22.84a8,8,0,0,0-4.6,4.6l-22.84,59.37A16,16,0,0,1,400,256Z"/></svg> Leitlearn Ai recherche des cartes pour vous...',e},x=()=>{const e=$("<div>").addClass("actions"),t=$("<div>").addClass("action update").html('<span class="material-symbols-rounded">restart_alt</span>'),a=$("<div>").addClass("action keep").html('<span class="material-symbols-rounded">done</span>');$("#ai-results").append(e),e.append(t,a),t.on("click",S),a.on("click",E)},S=async()=>{$(".ai-flashcards").empty(),$("#ai-results .actions").remove(),k();let e=await b();C(),_(e),x()},E=()=>{let e=[];$(".flashcards").children().each((function(t,a){let n=$(a).find(".question").text().trim(),s=$(a).find(".content").text().trim();if(n=n.replace("question:","").trim(),s=s.replace("answer:","").trim(),""!==n&&""!==s){let t={question:n,answer:s};e.push(t)}}));let t=$("#leitlearn_ai_input").val(),a={_csrfToken:y,flashcards:JSON.stringify(e),query:t};$.ajax({type:"POST",url:"/packets/aiResponse",data:a,success:function(e){window.location.href="/dashboard"}})},T=()=>{$(".search-users-group"),$("#search-users-input").on("input",(async function(){let e=$(this).val();if(""!==$.trim(e)){let t;try{t=await o("/api/users/get/",e),A(t)}catch(e){console.error("Une erreur est survenue lors de la récupération des utilisateurs :",e)}}}))},A=e=>{$("#users-result").empty(),e.forEach((e=>{const t=document.createElement("div");t.classList.add("user");const a=document.createElement("div");a.classList.add("profile-picture"),a.style.backgroundImage=`url('/img/user_profile_pic/${e.profile_picture}')`,t.append(a);const n=document.createElement("span");n.textContent=e.username,t.append(n);const s=document.createElement("a");s.href=`/users/view/${e.user_uid}`,s.innerHTML='<span class="material-symbols-rounded">open_in_new</span>',t.append(s),$("#users-result").append(t)}))},N=()=>{let e=$(".search-keywords");window.location.pathname.split("/").pop(),e.on("input",(function(){let e=$(this).val().toLowerCase();$(".keywords").each((function(){$(this).find("span").text().toLowerCase().includes(e)?$(this).show():$(this).hide()}))}))},B=()=>{const e=$(".redirect");$(document).on("click",".page-redirect[data-redirection]",(function(){const e=$(this).data("redirection");window.location.href=e})),$(document).on("click",".redirect",(function(){$("html, body").animate({scrollTop:0},"smooth")})),$(document).on("scroll",(function(){$(window).scrollTop()>50?e.addClass("show"):e.removeClass("show")})),$(".scroll-menu").each((function(){!function(e){const t=e.find(".scroll-content"),a=e.closest(".section-packets").find(".prev-button"),n=e.closest(".section-packets").find(".next-button");let s=0;function o(){t.css("transform",`translateX(-${s}px)`)}a.on("click",(function(){s-=200,s<0&&(s=0),o()})),n.on("click",(function(){s+=200,s>t[0].scrollWidth-t[0].clientWidth&&(s=t[0].scrollWidth-t[0].clientWidth),o()}))}($(this))}))},M=()=>{const e=$(".switch-tab"),t=$(".tab");e.on("click",(function(){e.removeClass("active"),t.hide(),$(this).addClass("active");const a=$(this).data("tab"),n=$("#"+a);"detail-tab-flashcards"===a||"dashboard-flashcards-tab"===a?n.show():n.css("display","flex")}))},F=()=>{$(document).on("click",".loader-button",(function(t){t.preventDefault();const a=$(this).closest("form"),n=$(this),s=n.find('input[type="submit"]'),o=n.find(".loader");e(a)?(s.val(""),o.show(),a.submit()):alert("Veuillez remplir tous les champs requis.")}));const e=e=>{let t=!0;return e.find("[required]").each((function(){if(""===$(this).val())return t=!1,!1})),t}};$(document).ready((function(){e(),i(),l(),c(),v(),w(),f(),m(),p(),u("#editor-flashcard-front","#editor-flashcard-back",".input-group.front",".input-group.back","question","answer"),u("#editor-modify-flashcard-front","#editor-modify-flashcard-back",".input-group.front.modify",".input-group.back.modify","question-modify","answer-modify"),(()=>{let e=$("#profile-picture"),t=$("#profilePicturePreview");e.on("change",(function(e){let a=e.target.files[0];if(a){let e=new FileReader;e.onload=function(e){t.attr("src",e.target.result)},e.readAsDataURL(a)}}))})(),T(),N(),0===$(".ia").length&&$(".dynamic-redirect").addClass("no-ia"),B(),(()=>{const e=$("#snackbar");setTimeout((function(){e.hasClass("show")&&e.removeClass("show")}),2700)})(),$(document).ready((function(){$(".loading-wrapper").hide()})),(()=>{let e=document.getElementById("market_search"),t=document.querySelector(".search-results");e&&(e.addEventListener("focus",(function(){t.classList.add("active")})),e.addEventListener("blur",(function(e){t.contains(e.relatedTarget)||t.classList.remove("active")})),t.addEventListener("mousedown",(function(e){e.preventDefault()})))})(),M(),F()}))})();